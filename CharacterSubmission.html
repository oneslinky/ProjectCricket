<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset="UTF-8">
        <title>CharacterSubmission</title>
        <link rel="stylesheet" href="StyleSheet.css">
    </head>
    <body>
        <h1>
           <strong>Welcome to Multiverse All Star Battlefront</strong> 
        </h1>
        <div id = "Intro/Disclaimer" class="overlay"> 
            <div class="popup">
                <h2>Disclaimer and Participation Agreement</h2>
                <p>By clicking "I Agree", you consent to participate in the Multiverse All Star Battlefront game. 
                    You acknowledge that you have read and understood the <a href = "*/insert rules and guidelines link*/" target ="_blank">rules and guidelines</a> of the game. 
                    You agree to abide by the <a href = "*/insert the terms and conditions link*/" target ="_blank">terms and conditions</a> set forth by the game developers. 
                    If you do not agree to these terms, please close the window and exit the game.
                </p>
                <button id="agreeBtn">I Agree</button>
            </div>
        </div>

        <div id = "timer">0:10</div>
        <p>
            You have 5 minutes to describe your character. 
            Please be as descriptive as possible. You can include their stats, 
            fighting style, memorable strengths and weaknesses, and any other relevant information.
            Once the timer hits zero, you will be prompted to submit your description or reset if you aren't pleased with your description.
        </p>
        <textarea id="description" rows="25" cols="175" placeholder="Type your description here..."></textarea>
        <br>
        <button id="submitBtn">Submit</button> 
        <button id="resetBtn">Reset</button>   
        <div id= "popupOverlay" class= "overlay">
            <div class="popup">
                <h2>Time's Up!</h2>
                <p>Your time is up. Please click the submit button if you are satisfied 
                    with your description or click reset to try again.
                </p>
                <button onclick="document.getElementById('popupOverlay').style.display='none';">Close</button>
            </div>
         </div>
         <div id = "missingdesc" class = "overlay">
            <div class = "popup">
                <h2>Please enter a description before submitting.</h2>
                <button onclick ="document.getElementById('missingdesc').style.display='none';">OK</button>
            </div>
         </div>

        <script>
            window.onload = function(){
                if(sessionStorage.getItem('suppressDisclaimerOnReturn') === '1'){
                    sessionStorage.removeItem('suppressDisclaimerOnReturn');
                    return;
                }
                if(sessionStorage.getItem('disclaimerAccepted') === '1'){
                    return;
                }

                showDisclaimer();
            };
            let resetBtn = document.getElementById('resetBtn');
            let submitBtn = document.getElementById('submitBtn');
            let countdownTime = 10; // insert minutes into seconds
            let timeleft = countdownTime;
            let descriptionBox = document.getElementById('description');
            let timerDisply = document.getElementById('timer');
            let timerRunning = false;
            let countdown;
            resetBtn.disabled = true;

            descriptionBox.addEventListener('input', startTimer);

            function startTimer(){
                if(timerRunning){
                    return;
            }
            timerRunning = true;
            descriptionBox.diabled = false;
            let countdown = setInterval(()=>{
                let minutes = Math.floor(timeleft / 60);
                let seconds = timeleft % 60;
                seconds = seconds < 10 ? '0' + seconds : seconds;
                timerDisply.textContent = `${minutes}:${seconds}`;
                timeleft--;

                if(timeleft <= 0){
                    timeleft = 0;
                    timerDisply.textContent = "0:00";
                    clearInterval(countdown);
                    showPopup();
                    descriptionBox.disabled = true;
                    timerRunning = false;
                    resetBtn.disabled = false;
                }
            }, 1000);
        }
        function showPopup(){
            document.getElementById('popupOverlay').style.display = 'flex';
        }
        function showDisclaimer(){
            document.getElementById('Intro/Disclaimer').style.display = 'flex';
        }
        document.getElementById('agreeBtn').addEventListener('click', function(){
            sessionStorage.setItem('disclaimerAccepted', '1');
            document.getElementById('Intro/Disclaimer').style.display = 'none';
        });

            submitBtn.addEventListener('click', function(){
            let description = descriptionBox.value;
            if(description.trim() === ''){
                document.getElementById('missingdesc').style.display = 'flex';
                return;
            }
            descriptionBox.disabled = true;
            window.location.href = 'CharacterStats.html';
            clearInterval(countdown);
            timerRunning = false;
        });

        resetBtn.addEventListener('click', function(){
            clearInterval(countdown);
            timeleft = countdownTime;
            timerDisply.textContent = "0:10";
            descriptionBox.value = '';
            descriptionBox.disabled = false;
            timerRunning = false;
        })
        </script>
    </body>
</html>