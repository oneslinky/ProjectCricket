<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset="UTF-8">
        <title>CharacterSubmission</title>
        <link rel="stylesheet" href="StyleSheet.css">
        <link rel="icon" type = "image/x-icon" href="https://raw.github.com/oneslinky/ProjectCricket/76f773d4979e9031c0e8b017f510a429897650b2/assests/favicon/Favicon%20Black%20Background%20Square.png">
        <!--<link rel="icon" tpye = "image/x-icon" href="/images/Favicon (Black).png"> for local use -->
    </head>
    <body class="submission-page" style = "background-image:url('https://raw.github.com/oneslinky/ProjectCricket/76f773d4979e9031c0e8b017f510a429897650b2/assests/Website%20Background.png');background-size: cover; background-repeat: no-repeat;">
        <div id = "Intro/Disclaimer" class="overlay"> 
            <div class="popup">
                <h2>Disclaimer and Participation Agreement</h2>
                <p>By clicking "I Agree", you consent to participate in the Multiverse All Star Battlefront game. 
                    You acknowledge that you have read and understood the <a href = 'RulesAndguidelines.html' target ="_blank">rules and guidelines</a> of the game. 
                    You agree to abide by the <a href = 'TermsAndConditions.html' target ="_blank">terms and conditions</a> set forth by the game developers. 
                    If you do not agree to these terms, please close the window and exit the game.
                </p>
                <button id="agreeBtn">I Agree</button>
            </div>
        </div>


        <div id = "timer">0:10</div>
        <p style = "color: ghostwhite;">
            You have 5 minutes to describe your character. 
            Please be as descriptive as possible. You can include their stats, 
            fighting style, memorable strengths and weaknesses, and any other relevant information.
            Once the timer hits zero, you will be prompted to submit your description or reset if you aren't pleased with your description.
        </p>
        <textarea id="description" rows="25" cols="165" placeholder="Type your description here..."></textarea>
        <br>
        <button id="submitBtn">Submit</button> 
        <button id="resetBtn">Reset</button>   
        <div id= "popupOverlay" class= "overlay">
            <div class="popup">
                <h2>Time's Up!</h2>
                <p>Your time is up. Please click the submit button if you are satisfied 
                    with your description or click reset to try again.
                </p>
                <button onclick="closeTimeUpPopup();">Close</button>
            </div>
         </div>
         <div id = "missingdesc" class = "overlay">
            <div class = "popup">
                <h2>Please enter a description before submitting.</h2>
                <button onclick ="document.getElementById('missingdesc').style.display='none';">OK</button>
            </div>
         </div>

        <script>
            window.onload = function(){
                if(sessionStorage.getItem('suppressDisclaimerOnReturn') === '1'){
                    sessionStorage.removeItem('suppressDisclaimerOnReturn');
                    return;
                }
                if(sessionStorage.getItem('disclaimerAccepted') === '1'){
                    return;
                }

                showDisclaimer();
            };
            let resetBtn = document.getElementById('resetBtn');
            let submitBtn = document.getElementById('submitBtn');
            let countdownTime = 10; // insert minutes into seconds
            let timeleft = countdownTime;
            let descriptionBox = document.getElementById('description');
            let timerDisply = document.getElementById('timer');
            let timerRunning = false;
            let countdown;
            resetBtn.disabled = true;
            descriptionBox.addEventListener('input', startTimer);
            descriptionBox.addEventListener('keydown', startTimer);
            descriptionBox.addEventListener('paste', startTimer);
            function updateTimerDisplay(){
                const minutes = Math.floor(timeleft / 60);
                const seconds = timeleft % 60;
                const secStr = seconds < 10 ? '0' + seconds : seconds;
                timerDisply.textContent = `${minutes}:${secStr}`;
            }

            function startTimer(){
                if(timerRunning){
                    return;
            }
            if(timerRunning) return;
            timerRunning = true;
            setTimerColor('#ffffff');
            descriptionBox.disabled = false;
            if(countdown) clearInterval(countdown);
            updateTimerDisplay();
            countdown = setInterval(()=>{
                timeleft--;
                if(timeleft <= 0){
                    timeleft = 0;
                    updateTimerDisplay();
                    clearInterval(countdown);
                    showPopup();
                    descriptionBox.disabled = true;
                    setTimerColor('#FF3B30');
                    const tEl = document.getElementById('timer');
                    if(tEl){
                        tEl.classList.add('blink');
                    }
                    timerRunning = false;
                    resetBtn.disabled = false;
                } else {
                    updateTimerDisplay();
                }
            }, 1000);
        }
        function showPopup(){
            document.getElementById('popupOverlay').style.display = 'flex';
        }
        function showDisclaimer(){
            document.getElementById('Intro/Disclaimer').style.display = 'flex';
        }
        document.getElementById('agreeBtn').addEventListener('click', function(){
            sessionStorage.setItem('disclaimerAccepted', '1');
            document.getElementById('Intro/Disclaimer').style.display = 'none';
        });

        function setTimerColor(color){
            const timerEl = document.getElementById('timer');
            if(timerEl) timerEl.style.color = color;
        }

        function closeTimeUpPopup(){
            const overlay = document.getElementById('popupOverlay');
            if(overlay) overlay.style.display = 'none';
            const tEl = document.getElementById('timer');
            if(tEl) tEl.classList.remove('blink');
            if(window._timerBlinkTimeout){
                clearTimeout(window._timerBlinkTimeout);
                window._timerBlinkTimeout = null;
            }
        }

            submitBtn.addEventListener('click', function(){
            let description = descriptionBox.value;
            if(description.trim() === ''){
                document.getElementById('missingdesc').style.display = 'flex';
                return;
            }
            descriptionBox.disabled = true;
            window.location.href = 'CharacterStats.html';
            clearInterval(countdown);
            timerRunning = false;
        });

        resetBtn.addEventListener('click', function(){
            clearInterval(countdown);
            timeleft = countdownTime;
            timerDisply.textContent = "0:10";
            descriptionBox.value = '';
            descriptionBox.disabled = false;
            setTimerColor('#2ecc71');
            const tEl = document.getElementById('timer');
            if(tEl){
                tEl.classList.remove('blink');
            }
            if(window._timerBlinkTimeout){
                clearTimeout(window._timerBlinkTimeout);
                window._timerBlinkTimeout = null;
            }
            timerRunning = false;
        })
        </script>
    </body>
</html>